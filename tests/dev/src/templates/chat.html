{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>Welcome, {{ username }}</h2>
  <h4>ðŸ§  Chat: {{ chat_name or "Untitled" }}</h4>

  <div class="mb-3 d-flex gap-2">
    <form method="POST" action="/chat/new">
      <button type="submit" class="btn btn-outline-primary btn-sm">âž• New Chat</button>
    </form>

    <form method="POST" action="/chat/rename" class="d-flex gap-2">
      <input name="new_name" class="form-control form-control-sm" placeholder="Rename chat...">
      <button type="submit" class="btn btn-outline-secondary btn-sm">ðŸ’¾ Save</button>
    </form>
  </div>

  <div class="chat-box border rounded p-3 mb-3" id="chatBox">
    {% if messages %}
      <ul class="list-group">
        {% for msg in messages %}
          <li class="list-group-item">
            <div>{{ msg.content }}</div>
            <small class="text-muted">{{ msg.timestamp }}</small>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No messages yet. Start chatting below!</p>
    {% endif %}
  </div>

  <form method="POST" class="d-flex align-items-start gap-2 mb-3">
    <div class="flex-grow-1">
      <textarea name="content" rows="2" class="form-control" placeholder="Type your message..." required></textarea>
    </div>
    <div class="w-25">
      <select name="project_id" class="form-select">
        <option value="">No Project</option>
        {% for project in projects %}
          <option value="{{ project.idproject }}" {% if selected_project_id == project.idproject %}selected{% endif %}>
            {{ project.name }}
          </option>
        {% endfor %}
      </select>
    </div>
    <button type="submit" class="btn btn-success">Send</button>
  </form>
</div>

<style>
  .chat-box {
    max-height: 400px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }
  .list-group {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
  }
</style>

<script>
  window.onload = function () {
    const chatBox = document.getElementById("chatBox");
    chatBox.scrollTop = chatBox.scrollHeight;
  };
</script>
{% endblock %}
